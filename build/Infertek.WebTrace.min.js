//Infertek.WebTrace v0.1.0 | (c) 2012 Tomasz Miku≈õ | http://www.opensource.org/licenses/mit-license
(function(window,undefined){window.Infertek||(window.Infertek={}),window.Infertek.WebTrace||(window.Infertek.WebTrace={}),window.Infertek.WebTrace.applicationStartTime=+(new Date),window.Infertek.WebTrace.eventsList=[],window.Infertek.WebTrace.collectEventsAsArchive=function(){return Base64.toBase64(RawDeflate.deflate(Base64.utob(JSON.stringify(window.Infertek.WebTrace.eventsList))))};var lastMouseMoveTimes=[],nodeIdentifier=0,infertek_webtrace_nodeid="infertek_webtrace_nodeid",infertek_webtrace_eventhandlersbound="infertek_webtrace_eventhandlersbound",nodeAppendChild=Node.prototype.appendChild,nodeInsertBefore=Node.prototype.insertBefore,nodeReplaceChild=Node.prototype.replaceChild,bindEventHandlers=function(node){if(node[infertek_webtrace_eventhandlersbound])return;node[infertek_webtrace_eventhandlersbound]=!0,$(node).on({click:reportEvent,dblclick:reportEvent,mousedown:reportEvent,mouseup:reportEvent,mouseover:reportEvent,mousemove:reportEvent,mouseout:reportEvent,keydown:reportEvent,keypress:reportEvent,keyup:reportEvent,load:reportEvent,unload:reportEvent,abort:reportEvent,error:reportEvent,resize:reportEvent,scroll:reportEvent,select:reportEvent,change:reportEvent,submit:reportEvent,reset:reportEvent,focus:reportEvent,blur:reportEvent,focusin:reportEvent,focusout:reportEvent})},generateNodeIdentifier=function(node){node[infertek_webtrace_nodeid]||(node[infertek_webtrace_nodeid]=nodeIdentifier++)},reportEvent=function(event){var dateTimeNow=+(new Date);if(event.type=="mousemove"){if(lastMouseMoveTimes[this[infertek_webtrace_nodeid]]&&dateTimeNow-lastMouseMoveTimes[this[infertek_webtrace_nodeid]]<36)return;lastMouseMoveTimes[this[infertek_webtrace_nodeid]]=dateTimeNow}window.Infertek.WebTrace.eventsList.push({event:{altKey:event.altKey,attrChange:event.attrChange,attrName:event.attrName,bubbles:event.bubbles,button:event.button,buttons:event.buttons,cancelable:event.cancelable,clientX:event.clientX,clientY:event.clientY,ctrlKey:event.ctrlKey,data:event.data,eventPhase:event.eventPhase,metaKey:event.metaKey,offsetX:event.offsetX,offsetY:event.offsetY,pageX:event.pageX,pageY:event.pageY,screenX:event.screenX,screenY:event.screenY,shiftKey:event.shiftKey,type:event.type,which:event.which},nodeID:this[infertek_webtrace_nodeid],timeFromApplicationStart:dateTimeNow-window.Infertek.WebTrace.applicationStartTime})};Node.prototype.appendChild=function(node){return generateNodeIdentifier(node),bindEventHandlers(node),nodeAppendChild.apply(this,arguments)},Node.prototype.insertBefore=function(newNode,referenceNode){return generateNodeIdentifier(newNode),bindEventHandlers(newNode),nodeInsertBefore.apply(this,arguments)},Node.prototype.replaceChild=function(newNode,oldNode){return generateNodeIdentifier(newNode),bindEventHandlers(newNode),nodeReplaceChild.apply(this,arguments)},$(function(){$("*").each(function(index,node){generateNodeIdentifier(node),bindEventHandlers(node)})})})(window,undefined)